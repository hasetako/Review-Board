<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${review.reviewTitle}">レビュー詳細</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 15px;
        }

        .label {
            font-weight: bold;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        pre {
            white-space: pre-wrap;
            font-family: inherit;
        }

        body {
            background-color: #f5f7fa;
        }

        .review-card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>

<body>

<div th:replace="fragments/header :: siteHeader('レビュー詳細')"></div>

<div class="container my-4">

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div th:unless="${error}">
        <div class="review-card">

            <!-- タイトル -->
            <h1 class="h4 mb-3" th:text="${review.reviewTitle}">レビュータイトル</h1>

            <!-- メタ情報 -->
            <div class="text-muted mb-3">
                <span>
                    <i class="bi" th:each="i : ${#numbers.sequence(1,5)}"
                       th:classappend="${i <= review.rate} ? 'bi-star-fill text-warning' : 'bi-star text-warning'"></i>
                    <span th:text="${review.rate + ' / 5'}">4 / 5</span>
                </span>

                <!-- ★複数カテゴリ -->
                <span th:if="${review.categories != null and !#lists.isEmpty(review.categories)}">
                    ｜カテゴリ:
                    <span th:each="c : ${review.categories}" class="badge bg-secondary me-1">
                        <a th:href="@{|/categories/${c.categoryId}|}"
                           th:text="${c.categoryName}"
                           class="text-white text-decoration-none">カテゴリ</a>
                    </span>
                </span>

                <span th:if="${review.user}">
                    ｜投稿者:
                    <a th:href="@{|/user/${review.user.id}|}" th:text="${review.user.username}">username</a>
                </span>
            </div>

            <!-- 対象コンテンツ -->
            <div class="d-flex align-items-center mb-3">
                <img class="thumb" th:if="${review.contents.thumbnail}" th:src="${review.contents.thumbnail}"
                     alt="thumbnail">
                <div>
                    <div class="label">対象のコンテンツ</div>
                    <div class="fw-bold" th:text="${review.contents.contentsTitle}">コンテンツタイトル</div>
                    <div>
                        <a th:href="${review.contents.contentsUrl}" th:text="${review.contents.contentsUrl}"
                           target="_blank" rel="noopener">https://example.com</a>
                    </div>
                </div>
            </div>

            <!-- レビュー内容 -->
            <div class="box">
                <div class="label mb-2">レビュー内容</div>
                <pre th:text="${review.reviewText}">本文がここに入ります。</pre>
            </div>
        </div>

        <!-- 同じコンテンツの他ユーザーのレビュー -->
        <div th:if="${otherReviews != null and !#lists.isEmpty(otherReviews)}" class="mt-4">
            <h2 class="h5 mb-3">同じコンテンツの他ユーザーのレビュー</h2>

            <a th:each="r : ${otherReviews}" th:href="@{|/reviews/${r.reviewId}|}" class="text-decoration-none">
                <div class="review-card">
                    <div class="fw-bold" th:text="${r.reviewTitle}">レビュータイトル</div>

                    <div class="text-muted small mt-1">
                        <!-- ★他レビュー側もカテゴリをバッジ表示 -->
                        <span th:if="${r.categories != null and !#lists.isEmpty(r.categories)}">
                            <span th:each="c : ${r.categories}" class="badge bg-secondary me-1">
                                <a th:href="@{|/categories/${c.categoryId}|}"
                                   th:text="${c.categoryName}"
                                   class="text-white text-decoration-none"
                                   th:onclick="|event.stopPropagation();|"></a>
                            </span>
                        </span>

                        <span th:if="${r.user}">
                            ｜投稿者:
                            <a th:href="@{|/user/${r.user.id}|}"
                               th:text="${r.user.username}"
                               th:onclick="|event.stopPropagation();|"></a>
                        </span>
                    </div>
                </div>
            </a>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>
