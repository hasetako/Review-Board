<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8">
	<title th:text="'検索結果: ' + ${keyword}">検索結果</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<style>
		body {
			background-color: #f8f9fa;
		}

		.search_results-section {
			display: flex;
			flex-direction: column;
			align-items: center;
			text-align: center;
		}

		.search-bar {
			max-width: 600px;
			margin: 30px auto;
		}

		.thumb {
			width: 96px;
			height: 96px;
			object-fit: cover;
			border-radius: 8px;
			border: 1px solid #eee;
		}

		a.title {
			font-weight: bold;
			text-decoration: none;
			color: #000;
		}

		.card-custom {
			background-color: #6ee9ff;
			border: none;
			border-radius: 15px;
			color: #000;
			transition: transform 0.2s;
		}

		.card-custom:hover {
			transform: translateY(-5px);
		}

		.pagination .page-item.active .page-link {
			background-color: #000;
			border-color: #000;
		}
	</style>
</head>

<body>
	<!-- 共通ヘッダー -->
	<div th:replace="fragments/header :: siteHeader(${ '検索結果: ' + keyword })"></div>

	<div class="search_results-section">
		<h5>キーワードの検索結果</h5>
		<form class="d-flex rb-search mx-auto w-50 mt-2 mt-lg-0" role="search" th:action="@{/search}" method="get">
			<input class="form-control flex-grow-1" type="text" name="keyword" placeholder="検索結果の表示" aria-label="Search"
				th:value="${keyword}">
			<button class="btn btn-outline-dark ms-2" type="submit">検索</button>
		</form>
		<p class="mt-3" th:text="${totalCount} + '件中' + ${reviews.size()} + '件表示'">50件中12件表示</p>
	</div>

	<div class="container my-4">
<!--		<div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>-->
		<div th:if="${keyword == null or #strings.isEmpty(keyword)}" class="alert alert-warning">
			キーワードを入力してください。
		</div>
		<div th:if="${keyword != null and !#strings.isEmpty(keyword) and #lists.isEmpty(reviews)}"
			class="alert alert-info">
			該当するレビューは見つかりませんでした。
		</div>

		<!-- カードリスト -->
		<div class="row g-3" th:each="r : ${reviews}">
			<div class="col-md-6 col-lg-4">
				<div class="card card-custom p-3 h-100">
					<div class="d-flex align-items-start gap-3">
						<img class="thumb" th:if="${r.contents.thumbnail}" th:src="${r.contents.thumbnail}" alt="thumb">
						<div class="flex-grow-1">
							<h5 class="card-title mb-1">
								<a class="title" th:href="@{|/reviews/${r.reviewId}|}"
									th:text="${r.reviewTitle}">レビュータイトル</a>
							</h5>
							<div class="mb-2 text-muted small">
								<span th:text="'評価: ' + ${r.rate} + ' / 5'"></span>
								<span th:if="${r.category}" th:text="' ｜カテゴリ: ' + ${r.category.categoryName}"></span>
								<span th:if="${r.user}">
									｜投稿者:
									<a th:href="@{|/user/${r.user.id}|}" th:text="${r.user.username}">username</a>
								</span>
							</div>
							<div>
								<a th:text="${r.contents.contentsTitle}">記事タイトル</a>
							</div>
							<p class="mt-2 mb-0" th:text="${
                    r.reviewText == null || #strings.isEmpty(r.reviewText) ? '' :
                    (#strings.length(r.reviewText) > 100 ?
                        #strings.substring(r.reviewText, 0, 100) + '…' :
                        r.reviewText)
                  }"></p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- ページネーション -->
		<!--    <nav class="mt-4 d-flex justify-content-center">-->
		<!--      <ul class="pagination">-->
		<!--        <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">-->
		<!--          <a class="page-link" th:href="@{/search(keyword=${keyword}, page=${currentPage - 1})}">&laquo;</a>-->
		<!--        </li>-->
		<!--        <li class="page-item"-->
		<!--            th:each="page : ${#numbers.sequence(1, totalPages)}"-->
		<!--            th:classappend="${page == currentPage} ? 'active'">-->
		<!--          <a class="page-link" th:href="@{/search(keyword=${keyword}, page=${page})}" th:text="${page}">1</a>-->
		<!--        </li>-->
		<!--        <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">-->
		<!--          <a class="page-link" th:href="@{/search(keyword=${keyword}, page=${currentPage + 1})}">&raquo;</a>-->
		<!--        </li>-->
		<!--      </ul>-->
		<!--    </nav>-->
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
</body>

</html>